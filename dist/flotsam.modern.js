class t{constructor(t){this.eventName=t,this.callbacks=[]}registerCallback(t){this.callbacks.push(t)}unregisterCallback(t){const e=this.callbacks.indexOf(t);e>-1&&this.callbacks.splice(e,1)}fire(t){this.callbacks.slice(0).forEach(e=>{e(t)})}}class e{constructor(){this.events={},this.uid=Math.floor(1e3+9e4*Math.random())}dispatch(t,e){const i=this.events[t];i&&i.fire(e)}on(e,i){let s=this.events[e];s||(s=new t(e),this.events[e]=s),s.registerCallback(i)}off(t,e){const i=this.events[t];i&&i.callbacks.indexOf(e)>-1&&(i.unregisterCallback(e),0===i.callbacks.length&&delete this.events[t])}}const i="is-open";class s extends e{constructor(t){super(),this.options=t,this.$input=t.el,this.data=!!t.data&&t.data,this.minChars=t.minChars?t.minChars:2,this.inputPreview=!t.inputPreview||t.inputPreview,this.onAjax=t.onAjax,this.hint=t.hint?t.hint:"When autocomplete results are available use up and down arrows to review and enter to select.",this.isEmpty=!0,this.hasEmptyState=!0,this.isOpen=!1,this.init()}setUp(){this.$input.setAttribute("autocomplete","off"),this.$input.setAttribute("aria-expanded","false"),this.$input.setAttribute("aria-haspopup","listbox"),this.$input.setAttribute("role","combobox"),this.$input.setAttribute("aria-autocomplete","list"),this.$input.setAttribute("aria-owns",`modal-${this.uid}-list`),this.$input.id=`autocomplete-input-${this.uid}`,this.$input.setAttribute("aria-describedby",`assistiveHint-${this.uid}`)}initModal(){this.$input.insertAdjacentHTML("afterend",this.generateModal()),this.$input.insertAdjacentHTML("afterend",this.generateAssistiveHint()),this.$input.insertAdjacentHTML("afterend",this.generateStatus()),this.$modal=document.querySelector(`#modal-${this.uid}`),this.$status=document.querySelector(`#status-${this.uid}`),this.list=this.$modal.querySelector(".autocomplete-modal__list"),this.$empty=this.$modal.querySelector(".autocomplete-modal__empty"),this.$modal.style.pointerEvents="none",this.$modal.style.visibility="hidden"}initInputCheck(){this.isDisabled||this.$input.addEventListener("input",this.onAjax?t=>{this.value=t.target.value,this.minCharsExcceded()?(super.dispatch("loadingData",{input:this.$input,modal:this.$modal,flotsam:this,options:this.options}),this.onAjax(this.value).then(t=>{this.data=t,super.dispatch("loadedData",{input:this.$input,modal:this.$modal,flotsam:this,options:this.options}),this.update()})):this.isOpen&&this.closeModal()}:t=>{this.value=t.target.value,this.minCharsExcceded()?this.update():this.isOpen&&this.closeModal()})}generateAssistiveHint(){return`\n            <div id="assistiveHint-${this.uid}" style="display: none">\n                ${this.hint}\n            </div>\n        `}generateStatus(){return`\n            <div id="status-${this.uid}" aria-role='status' aria-live="polite" style="display: none">\n                \n            </div>\n        `}update(){0!==this.data.length&&(this.data=this.data.filter(t=>{if(t.toLowerCase().includes(this.value.toLowerCase()))return t})),0===this.data.length?this.showEmptyState():(this.hideEmptyState(),this.generateListItems(),!1===this.isOpen&&this.openModal())}preventSubmit(t){t.preventDefault()}showEmptyState(){this.removeListItems(),this.$empty.innerHTML=`<div>Sorry there are no results for <strong>"${this.value}"</strong> please search again</div>`,this.$empty.style.display="block",this.isOpen||this.openModal()}hideEmptyState(){this.$empty.innerHTML="",this.$empty.style.display="none"}openModal(){this.isDisabled||(document.addEventListener("submit",this.preventSubmit),this.checkKey=this.checkKey.bind(this),document.addEventListener("keydown",this.checkKey,!0),this.isOpen=!0,this.$modal.style.pointerEvents="auto",this.$modal.style.visibility="visible",this.$input.classList.add(i),this.$input.setAttribute("aria-expanded","true"),super.dispatch("openModal",{input:this.$input,modal:this.$modal,flotsam:this,options:this.options}))}closeModal(){this.hideEmptyState(),this.removeListItems(),this.unsetSelected(),this.isOpen&&(document.removeEventListener("submit",this.preventSubmit),document.removeEventListener("keydown",this.checkKey,!0)),this.$modal.style.pointerEvents="none",this.$modal.style.visibility="hidden",this.$input.classList.remove(i),this.$input.focus(),this.isOpen=!1,super.dispatch("closeModal",{input:this.$input,modal:this.$modal,flotsam:this,options:this.options})}checkKey(t){"38"==t.keyCode?this.selectPrev():"40"==t.keyCode?this.selectNext():"37"==t.keyCode||"39"==t.keyCode||("27"==t.keyCode||"9"==t.keyCode?(t.preventDefault(),this.closeModal()):"13"==t.keyCode&&(t.preventDefault(),this.closeModal(),this.$input.closest("form").submit()))}selectItem(){[...this.list.querySelectorAll("li")].forEach((t,e)=>{e===this.currentSelected?(t.classList.add("selected-item"),t.setAttribute("aria-selected","true"),console.log(t.id),console.log(t),this.$input.setAttribute("aria-activedescendant",t.id),this.inputPreview&&this.setInput(t.innerText),super.dispatch("selectKey",{selected:t.textContent,input:this.$input,modal:this.$modal,flotsam:this,options:this.options})):(t.classList.remove("selected-item"),t.setAttribute("aria-selected","false"))})}selectNext(){this.currentSelected=null===this.currentSelected?0:this.currentSelected+1,this.selectItem()}selectPrev(){this.currentSelected=this.currentSelected-1,this.selectItem()}unsetSelected(){this.currentSelected=null;const t=[...this.list.querySelectorAll("li")];this.$input.removeAttribute("aria-activedescendant"),t.forEach(t=>{t.classList.remove("selected-item")})}generateModal(){return console.log(this.uid),`\n        <div class="autocomplete-modal" id="modal-${this.uid}" >\n            <div class="autocomplete-modal__inner">\n                <ul \n                    class="autocomplete-modal__list" \n                    role="listbox" \n                    id="modal-${this.uid}-list">\n                </ul>\n                <div class="autocomplete-modal__empty" style="display: none"></div>\n            </div>\n        </div>\n    `}generateListItems(){this.unsetSelected();let t="";this.data.forEach((e,i)=>{const s=new RegExp(this.value,"gi"),a=e.replace(s,t=>'<span class="autocomplete-modal__list-highlight">'+t+"</span>");t+=`\n                <li class="autocomplete-modal__list-item" role="option" aria-posinset="${i+1}" aria-setsize="${this.data.length}" aria-selected="false" id="list-item-${i}--${this.uid}" tab-index="-1">\n                    ${a}\n                </li>`}),this.list.innerHTML=t,[...this.list.querySelectorAll("li")].forEach(t=>{t.addEventListener("click",()=>{this.setInput(t.innerText),this.closeModal()})})}removeListItems(){this.list.innerHTML=""}setInput(t){this.$input.value=t}triggerClose(){this.closeModal()}triggerDisable(){this.isDisabled=!0,this.closeModal(),super.dispatch("disabled",{input:this.$input,modal:this.$modal,flotsam:this,options:this.options})}triggerEnable(){this.isDisabled=!1}minCharsExcceded(){return this.value.length>=this.minChars}init(){this._self=this,this.currentSelected=null,this.isDisabled=!1,this.setUp(),this.initModal(),this.initInputCheck(),console.log(this.uid),setTimeout(()=>{super.dispatch("init",{input:this.$input,modal:this.$modal,flotsam:this,options:this.options})},0)}}export{s as default};
//# sourceMappingURL=flotsam.modern.js.map
